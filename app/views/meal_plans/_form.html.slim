/ Mobile: single column, Desktop: 2/3 + 1/3
.grid.lg:grid-cols-3.gap-4.sm:gap-8
  / Main form
  .lg:col-span-2
    = form_with model: @meal_plan, id: "meal_plan_form", class: "space-y-4 sm:space-y-6" do |f|
      - if @meal_plan.errors.any?
        .card.bg-red-50.border-red-200.p-4.sm:p-6.mb-4.sm:mb-6
          .flex.items-start.gap-3.sm:gap-4
            .w-8.h-8.sm:w-10.sm:h-10.bg-red-100.rounded-xl.flex.items-center.justify-center.text-red-500.flex-shrink-0
              span âš ï¸
            div
              h3.font-semibold.text-red-800.mb-1.sm:mb-2.text-sm.sm:text-base
                = "#{@meal_plan.errors.count} erreur(s)"
              ul.text-xs.sm:text-sm.text-red-600.space-y-1
                - @meal_plan.errors.full_messages.each do |message|
                  li = message

      .card.p-4.sm:p-8.space-y-4.sm:space-y-6
        h2.text-lg.sm:text-xl.font-display.font-bold.text-navy.flex.items-center.gap-2.sm:gap-3.mb-1.sm:mb-2
          span ğŸ“…
          | Planifier un repas

        .space-y-4.sm:space-y-5
          .form-group
            = f.label :date, class: "form-label text-sm sm:text-base"
              span Date
              span.text-terracotta.ml-1 *
            
            - date_value = @meal_plan.date || params[:date] || Date.today
            .relative data-controller="date-picker" data-date-picker-date-value="#{date_value}"
              / Hidden input for form submission
              = f.hidden_field :date, value: date_value, data: { date_picker_target: "input" }
              
              / Trigger button with date display
              button.w-full.p-3.sm:p-4.rounded-xl.border-2.border-cream-dark.bg-white.text-left.transition-all.hover:border-sage.focus:outline-none.focus:border-sage.focus:ring-4.focus:ring-sage/20 type="button" data-action="click->date-picker#toggle"
                div data-date-picker-target="display"
                  .flex.items-center.gap-3
                    .w-12.h-12.bg-terracotta/10.rounded-xl.flex.flex-col.items-center.justify-center
                      span.text-xs.text-terracotta.font-medium.uppercase = l(date_value.to_date, format: "%a")
                      span.text-lg.font-bold.text-terracotta.leading-none = date_value.to_date.day
                    div
                      .font-semibold.text-navy = l(date_value.to_date, format: "%B %Y").capitalize
                      .text-sm.text-navy/60 Cliquez pour modifier
                    span.ml-auto.text-navy/40 ğŸ“…
              
              / Calendar dropdown
              .hidden.absolute.z-50.mt-2.left-0.bg-white.rounded-xl.shadow-xl.border.border-cream-dark.overflow-hidden.p-4 data-date-picker-target="calendar" style="width: 320px"
                / Month navigation
                .flex.items-center.justify-between.mb-4
                  button.w-8.h-8.rounded-lg.hover:bg-cream.flex.items-center.justify-center.text-navy/60.hover:text-navy.transition-colors type="button" data-action="click->date-picker#previousMonth"
                    | â†
                  span.font-semibold.text-navy data-date-picker-target="monthYear"
                  button.w-8.h-8.rounded-lg.hover:bg-cream.flex.items-center.justify-center.text-navy/60.hover:text-navy.transition-colors type="button" data-action="click->date-picker#nextMonth"
                    | â†’
                
                / Days header
                .grid.grid-cols-7.gap-1.mb-2
                  - %w[Lun Mar Mer Jeu Ven Sam Dim].each do |day|
                    .p-2.text-center.text-xs.font-semibold.text-navy/50 = day
                
                / Calendar grid
                .grid.grid-cols-7.gap-1 data-date-picker-target="grid"

          .form-group
            = f.label :meal_type, class: "form-label text-sm sm:text-base"
              span Type de repas
              span.text-terracotta.ml-1 *
            / 2x2 grid on mobile, 4 columns on larger screens
            .grid.grid-cols-2.sm:grid-cols-4.gap-2.sm:gap-3
              - MealPlan::MEAL_TYPES.each do |type|
                - icon = type == 'breakfast' ? 'ğŸŒ…' : type == 'lunch' ? 'â˜€ï¸' : type == 'dinner' ? 'ğŸŒ™' : 'ğŸª'
                - bg_class = type == 'breakfast' ? 'peer-checked:bg-mustard peer-checked:border-mustard' : type == 'lunch' ? 'peer-checked:bg-sage peer-checked:border-sage' : type == 'dinner' ? 'peer-checked:bg-terracotta peer-checked:border-terracotta' : 'peer-checked:bg-navy peer-checked:border-navy'
                label.cursor-pointer
                  = f.radio_button :meal_type, type, class: "peer sr-only"
                  .p-3.sm:p-4.rounded-xl.border-2.border-cream-dark.text-center.transition-all.peer-checked:text-white class=bg_class
                    .text-xl.sm:text-2xl.mb-0.5.sm:mb-1 = icon
                    .text-xs.sm:text-sm.font-medium = type.capitalize

          .form-group
            = f.label :recipe_id, class: "form-label text-sm sm:text-base"
              span Recette
              span.text-terracotta.ml-1 *
            
            - if @recipes.any?
              .relative data-controller="recipe-select"
                / Hidden input for form submission
                = f.hidden_field :recipe_id, data: { recipe_select_target: "hiddenInput" }
                
                / Trigger button
                button.w-full.p-3.sm:p-4.rounded-xl.border-2.border-cream-dark.bg-white.text-left.transition-all.hover:border-sage.focus:outline-none.focus:border-sage.focus:ring-4.focus:ring-sage/20 type="button" data-recipe-select-target="input" data-action="click->recipe-select#toggle" aria-expanded="false" aria-haspopup="listbox"
                  div data-recipe-select-target="selected"
                    - if @meal_plan.recipe_id.present?
                      - selected_recipe = @recipes.find { |r| r.id == @meal_plan.recipe_id }
                      - if selected_recipe
                        .flex.items-center.gap-3.sm:gap-4
                          .w-10.h-10.sm:w-12.sm:h-12.bg-terracotta/10.rounded-xl.flex.items-center.justify-center.text-xl.sm:text-2xl.flex-shrink-0
                            | ğŸ³
                          .flex-1.min-w-0
                            h4.font-semibold.text-navy.text-sm.sm:text-base.truncate = selected_recipe.title
                            .flex.items-center.gap-2.sm:gap-4.text-xs.sm:text-sm.text-navy/60.mt-0.5.sm:mt-1
                              - if selected_recipe.preparation_time
                                span â±ï¸ #{selected_recipe.preparation_time}min
                              span ğŸ¥• #{selected_recipe.ingredients.count}
                          .text-sage.text-xl âœ“
                      - else
                        .flex.items-center.gap-3.text-navy/50
                          span.text-xl ğŸ”
                          span SÃ©lectionner une recette...
                          span.ml-auto.text-sm â–¼
                    - else
                      .flex.items-center.gap-3.text-navy/50
                        span.text-xl ğŸ”
                        span SÃ©lectionner une recette...
                        span.ml-auto.text-sm â–¼
                
                / Dropdown
                .hidden.absolute.z-50.mt-2.w-full.bg-white.rounded-xl.shadow-xl.border.border-cream-dark.overflow-hidden data-recipe-select-target="dropdown"
                  / Search input
                  .p-3.border-b.border-cream-dark
                    input.w-full.px-3.py-2.rounded-lg.border.border-cream-dark.bg-cream/30.text-sm.placeholder-navy/40.focus:outline-none.focus:border-sage type="text" placeholder="Rechercher une recette..." data-recipe-select-target="search" data-action="input->recipe-select#filter"
                  
                  / Options list
                  .max-h-64.overflow-y-auto.p-2
                    - @recipes.each do |recipe|
                      .p-3.rounded-xl.cursor-pointer.transition-all.hover:bg-cream/50 data-recipe-select-target="option" data-action="click->recipe-select#select" data-id="#{recipe.id}" data-title="#{recipe.title}" data-time="#{recipe.preparation_time}" data-ingredients="#{recipe.ingredients.count}" class="#{@meal_plan.recipe_id == recipe.id ? 'ring-2 ring-terracotta bg-terracotta/5' : ''}"
                        .flex.items-center.gap-3.sm:gap-4
                          .w-10.h-10.bg-cream.rounded-xl.flex.items-center.justify-center.text-xl.flex-shrink-0
                            | ğŸ³
                          .flex-1.min-w-0
                            h4.font-semibold.text-navy.text-sm.truncate = recipe.title
                            .flex.items-center.gap-2.sm:gap-4.text-xs.text-navy/60.mt-0.5
                              - if recipe.preparation_time
                                span â±ï¸ #{recipe.preparation_time}min
                              span ğŸ¥• #{recipe.ingredients.count}
            - else
              .p-6.sm:p-8.bg-cream/50.rounded-xl.text-center
                .text-3xl.sm:text-4xl.mb-3.sm:mb-4 ğŸ“–
                p.text-navy/60.mb-3.sm:mb-4.text-sm.sm:text-base Aucune recette
                = link_to new_recipe_path, class: "btn btn-primary btn-sm sm:btn-md"
                  span âœ¨
                  span CrÃ©er une recette

      / Actions (only for new meal plans)
      - if @recipes.any? && !@meal_plan.persisted?
        .grid.grid-cols-2.sm:flex.sm:flex-row.gap-3.sm:gap-4.pt-2.sm:pt-4
          = f.submit class: "btn btn-primary col-span-2 sm:flex-none justify-center"
          = link_to "Annuler", meal_plans_path, class: "btn btn-outline col-span-2 sm:col-span-1 justify-center"

  / Sidebar (hidden on mobile by default, could be collapsible)
  .hidden.lg:block.space-y-6
    .card.p-6.bg-gradient-to-br.from-sage/10.to-sage/5
      .flex.items-center.gap-3.mb-4
        .w-10.h-10.bg-sage/20.rounded-xl.flex.items-center.justify-center
          span ğŸ’¡
        h3.font-semibold.text-navy Conseil

      p.text-sm.text-navy/70
        | Planifiez vos repas Ã  l'avance pour gagner du temps et Ã©viter le stress du "qu'est-ce qu'on mange ce soir ?"

    .card.p-6
      .flex.items-center.gap-3.mb-4
        .w-10.h-10.bg-mustard/30.rounded-xl.flex.items-center.justify-center
          span ğŸ½ï¸
        h3.font-semibold.text-navy Types de repas

      ul.space-y-3.text-sm.text-navy/70
        li.flex.items-center.gap-2
          span ğŸŒ…
          span.font-medium Breakfast
          span.text-navy/50 â€” Petit-dÃ©jeuner
        li.flex.items-center.gap-2
          span â˜€ï¸
          span.font-medium Lunch
          span.text-navy/50 â€” DÃ©jeuner
        li.flex.items-center.gap-2
          span ğŸŒ™
          span.font-medium Dinner
          span.text-navy/50 â€” DÃ®ner
        li.flex.items-center.gap-2
          span ğŸª
          span.font-medium Snack
          span.text-navy/50 â€” En-cas
