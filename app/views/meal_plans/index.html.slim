/ Welcome header
.mb-6.sm:mb-8
  .flex.flex-col.sm:flex-row.sm:items-center.sm:justify-between.gap-4.sm:gap-6
    div
      h1.text-2xl.sm:text-3xl.lg:text-4xl.font-display.font-bold.text-navy.flex.items-center.gap-2.sm:gap-3
        span.text-xl.sm:text-2xl ğŸ—“ï¸
        | Ma semaine
      p.text-navy/60.mt-1.sm:mt-2.text-sm.sm:text-lg Qu'est-ce qu'on mange ?

    = link_to recipes_path, class: "btn btn-outline w-full sm:w-auto justify-center"
      span ğŸ“–
      span Mes recettes

/ Week navigation (Monday to Sunday)
- current_week_start = params[:week] ? Date.parse(params[:week]).beginning_of_week(:monday) : Date.today.beginning_of_week(:monday)
- current_week_end = current_week_start.end_of_week(:monday)

.flex.items-center.justify-between.gap-2.mb-4.sm:mb-6
  = link_to meal_plans_path(week: (current_week_start - 7.days).to_s), class: "btn btn-ghost btn-sm p-2 sm:px-4"
    span â†
    span.hidden.sm:inline.ml-1 Semaine prÃ©c.

  .text-center.flex-1.min-w-0
    h2.text-sm.sm:text-lg.font-display.font-bold.text-navy.truncate
      | Semaine du
      = l(current_week_start, format: " %d")
      |  au
      = l(current_week_end, format: " %d %B %Y")
    - if Date.today >= current_week_start && Date.today <= current_week_end
      span.badge.badge-sage.text-xs.mt-1 Semaine en cours

  = link_to meal_plans_path(week: (current_week_start + 7.days).to_s), class: "btn btn-ghost btn-sm p-2 sm:px-4"
    span.hidden.sm:inline.mr-1 Semaine suiv.
    span â†’

/ Week calendar
- week_plans = @meal_plans.where(date: current_week_start..current_week_end).group_by(&:date)

/ Desktop view (7 columns) - Redesigned
.hidden.lg:block
  .bg-white.rounded-2xl.shadow-lg.border.border-cream-dark/50.overflow-hidden
    / Days header row
    .grid.grid-cols-7.border-b.border-cream-dark/50
      - (current_week_start..current_week_end).each do |date|
        - is_today = date == Date.today
        .p-4.text-center.border-r.border-cream-dark/30.last:border-r-0 class="#{is_today ? 'bg-terracotta text-white' : 'bg-cream/50'}"
          .text-xs.font-semibold.uppercase.tracking-wider.mb-1 class="#{is_today ? 'text-white/80' : 'text-navy/50'}"
            = l(date, format: "%A")
          .text-2xl.font-display.font-bold class="#{is_today ? 'text-white' : 'text-navy'}"
            = date.day
          .text-xs.mt-1 class="#{is_today ? 'text-white/70' : 'text-navy/40'}"
            = l(date, format: "%B")

    / Meals grid
    .grid.grid-cols-7
      - (current_week_start..current_week_end).each do |date|
        - day_plans = week_plans[date] || []
        - is_today = date == Date.today
        - is_past = date < Date.today
        
        .min-h-40.p-3.border-r.border-cream-dark/30.last:border-r-0.flex.flex-col class="#{is_past ? 'bg-navy/5 opacity-60' : is_today ? 'bg-terracotta/5' : 'bg-white'}"
          - if day_plans.any?
            .space-y-2.flex-1
              - day_plans.sort_by { |p| MealPlan::MEAL_TYPES.index(p.meal_type) || 99 }.each do |plan|
                - bg_color = plan.meal_type == 'breakfast' ? 'bg-mustard/20 hover:bg-mustard/30 border-mustard/30' : plan.meal_type == 'lunch' ? 'bg-sage/20 hover:bg-sage/30 border-sage/30' : plan.meal_type == 'dinner' ? 'bg-terracotta/10 hover:bg-terracotta/20 border-terracotta/20' : 'bg-navy/5 hover:bg-navy/10 border-navy/10'
                - text_color = plan.meal_type == 'breakfast' ? 'text-mustard-dark' : plan.meal_type == 'lunch' ? 'text-sage-dark' : plan.meal_type == 'dinner' ? 'text-terracotta' : 'text-navy/60'
                .group.relative.p-2.rounded-xl.border.transition-all.cursor-default class=bg_color
                  / Meal type badge
                  .flex.items-center.gap-1.5.mb-1
                    span.text-sm = plan.meal_type == 'breakfast' ? 'ğŸŒ…' : plan.meal_type == 'lunch' ? 'â˜€ï¸' : plan.meal_type == 'dinner' ? 'ğŸŒ™' : 'ğŸª'
                    span.text-xs.font-semibold.uppercase.tracking-wide class=text_color
                      = plan.meal_type == 'breakfast' ? 'Petit-dÃ©j' : plan.meal_type == 'lunch' ? 'DÃ©jeuner' : plan.meal_type == 'dinner' ? 'DÃ®ner' : 'Snack'
                  / Recipe title (clickable)
                  = link_to recipe_path(plan.recipe), class: "block text-sm text-navy font-medium leading-snug hover:text-terracotta transition-colors line-clamp-2"
                    = plan.recipe.title
                  / Actions dropdown on hover
                  .absolute.top-1.right-1.opacity-0.group-hover:opacity-100.transition-opacity.flex.gap-1
                    = link_to edit_meal_plan_path(plan), class: "w-7 h-7 rounded-lg bg-white shadow-sm hover:shadow flex items-center justify-center text-navy/50 hover:text-navy transition-all", title: "Changer de jour"
                      svg.w-4.h-4 xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"
                        path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                    = link_to meal_plan_path(plan), data: { turbo_method: :delete, turbo_confirm: "Retirer #{plan.recipe.title} ?" }, class: "w-7 h-7 rounded-lg bg-white shadow-sm hover:shadow hover:bg-red-50 flex items-center justify-center text-navy/50 hover:text-red-500 transition-all", title: "Retirer"
                      span.text-sm Ã—
          - if !is_past
            .flex.items-center.justify-center.pt-2 class="#{day_plans.empty? ? 'flex-1' : ''}"
              = link_to recipes_path(date: date, meal_type: 'dinner'), class: "w-8 h-8 rounded-xl bg-cream hover:bg-sage/20 flex items-center justify-center text-navy/30 hover:text-sage text-lg transition-all hover:scale-110"
                | +

/ Tablet view (2 columns)
.hidden.sm:grid.sm:grid-cols-2.lg:hidden.gap-3
  - (current_week_start..current_week_end).each do |date|
    - day_plans = week_plans[date] || []
    - is_today = date == Date.today
    - is_past = date < Date.today

    .card.overflow-hidden class="#{is_today ? 'ring-2 ring-terracotta' : ''} #{is_past ? 'opacity-50' : ''}"
      .flex.items-stretch
        / Date column
        .w-16.flex-shrink-0.p-3.flex.flex-col.items-center.justify-center class="#{is_today ? 'bg-terracotta text-white' : 'bg-cream'}"
          .text-xs.font-semibold.uppercase class="#{is_today ? 'text-white/80' : 'text-navy/50'}"
            = l(date, format: "%a")
          .text-2xl.font-display.font-bold class="#{is_today ? 'text-white' : 'text-navy'}"
            = date.day

        / Meals column
        .flex-1.p-3.min-h-16.flex.flex-col
          - if day_plans.any?
            .space-y-1.5.flex-1
              - day_plans.sort_by { |p| MealPlan::MEAL_TYPES.index(p.meal_type) || 99 }.each do |plan|
                .group.flex.items-center.gap-2.p-2.rounded-lg.transition-colors class="#{plan.meal_type == 'breakfast' ? 'bg-mustard/20 hover:bg-mustard/30' : plan.meal_type == 'lunch' ? 'bg-sage/20 hover:bg-sage/30' : plan.meal_type == 'dinner' ? 'bg-terracotta/10 hover:bg-terracotta/20' : 'bg-navy/5 hover:bg-navy/10'}"
                  span.text-sm = plan.meal_type == 'breakfast' ? 'ğŸŒ…' : plan.meal_type == 'lunch' ? 'â˜€ï¸' : plan.meal_type == 'dinner' ? 'ğŸŒ™' : 'ğŸª'
                  = link_to recipe_path(plan.recipe), class: "flex-1 text-sm font-medium text-navy truncate hover:text-terracotta transition-colors"
                    = plan.recipe.title
                  / Action buttons
                  .flex.gap-1.opacity-0.group-hover:opacity-100.transition-opacity
                    = link_to edit_meal_plan_path(plan), class: "w-7 h-7 rounded-lg bg-white/80 hover:bg-white flex items-center justify-center shadow-sm text-navy/50 hover:text-navy", title: "Changer de jour"
                      svg.w-4.h-4 xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"
                        path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                    = link_to meal_plan_path(plan), data: { turbo_method: :delete, turbo_confirm: "Retirer ce repas ?" }, class: "w-7 h-7 rounded-lg bg-white/80 hover:bg-red-50 flex items-center justify-center text-sm text-red-500 shadow-sm", title: "Retirer"
                      | Ã—
          - if !is_past
            .pt-1 class="#{day_plans.empty? ? 'flex-1 flex items-center' : ''}"
              = link_to recipes_path(date: date, meal_type: 'dinner'), class: "text-sm text-navy/40 hover:text-sage transition-colors"
                | + Ajouter

/ Mobile view (1 column)
.sm:hidden.space-y-2
  - (current_week_start..current_week_end).each do |date|
    - day_plans = week_plans[date] || []
    - is_today = date == Date.today
    - is_past = date < Date.today

    .card.overflow-hidden class="#{is_today ? 'ring-2 ring-terracotta' : ''} #{is_past ? 'opacity-50' : ''}"
      .flex.items-stretch
        / Date column
        .w-14.flex-shrink-0.p-2.flex.flex-col.items-center.justify-center class="#{is_today ? 'bg-terracotta text-white' : 'bg-cream'}"
          .text-xs.font-semibold.uppercase class="#{is_today ? 'text-white/80' : 'text-navy/50'}"
            = l(date, format: "%a")
          .text-xl.font-display.font-bold class="#{is_today ? 'text-white' : 'text-navy'}"
            = date.day

        / Meals column
        .flex-1.p-2.flex.flex-col
          - if day_plans.any?
            .space-y-1.5.flex-1
              - day_plans.sort_by { |p| MealPlan::MEAL_TYPES.index(p.meal_type) || 99 }.each do |plan|
                .flex.items-center.gap-2.p-2.rounded-lg class="#{plan.meal_type == 'breakfast' ? 'bg-mustard/20' : plan.meal_type == 'lunch' ? 'bg-sage/20' : plan.meal_type == 'dinner' ? 'bg-terracotta/10' : 'bg-navy/5'}"
                  span.text-base = plan.meal_type == 'breakfast' ? 'ğŸŒ…' : plan.meal_type == 'lunch' ? 'â˜€ï¸' : plan.meal_type == 'dinner' ? 'ğŸŒ™' : 'ğŸª'
                  = link_to recipe_path(plan.recipe), class: "flex-1 text-sm font-medium text-navy truncate active:text-terracotta"
                    = plan.recipe.title
                  / Action buttons (visible on mobile)
                  .flex.gap-1.5
                    = link_to edit_meal_plan_path(plan), class: "w-8 h-8 rounded-lg bg-white/70 active:bg-white flex items-center justify-center shadow-sm text-navy/50"
                      svg.w-5.h-5 xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"
                        path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                    = link_to meal_plan_path(plan), data: { turbo_method: :delete, turbo_confirm: "Retirer #{plan.recipe.title} ?" }, class: "w-8 h-8 rounded-lg bg-white/70 active:bg-red-50 flex items-center justify-center text-lg text-red-400 shadow-sm"
                      | Ã—
          - if !is_past
            .py-1 class="#{day_plans.empty? ? 'flex-1 flex items-center justify-center' : ''}"
              = link_to recipes_path(date: date, meal_type: 'dinner'), class: "text-sm text-navy/40 active:text-sage"
                | + Ajouter un repas

/ Legend
.card.p-3.sm:p-4.mt-4.sm:mt-6
  .flex.flex-wrap.items-center.justify-center.gap-3.sm:gap-6.text-xs.sm:text-sm
    .flex.items-center.gap-1.sm:gap-2
      .w-3.h-3.sm:w-4.sm:h-4.rounded.bg-mustard/30
      span.text-navy/70 ğŸŒ… Petit-dÃ©j.
    .flex.items-center.gap-1.sm:gap-2
      .w-3.h-3.sm:w-4.sm:h-4.rounded.bg-sage/30
      span.text-navy/70 â˜€ï¸ DÃ©jeuner
    .flex.items-center.gap-1.sm:gap-2
      .w-3.h-3.sm:w-4.sm:h-4.rounded.bg-terracotta/20
      span.text-navy/70 ğŸŒ™ DÃ®ner
    .flex.items-center.gap-1.sm:gap-2.hidden.sm:flex
      .w-3.h-3.sm:w-4.sm:h-4.rounded.bg-navy/10
      span.text-navy/70 ğŸª Snack

/ Tip for new users
- if current_user.recipes.count == 0
  .card.p-4.sm:p-6.mt-4.sm:mt-6.bg-gradient-to-r.from-sage/10.to-mustard/10.border-2.border-sage/20
    .flex.flex-col.sm:flex-row.items-start.gap-3.sm:gap-4
      .text-3xl.sm:text-4xl ğŸ’¡
      div.flex-1
        h3.font-display.font-bold.text-navy.mb-1.sm:mb-2 Pour commencer
        p.text-navy/70.text-sm.sm:text-base.mb-3.sm:mb-4
          | CrÃ©ez d'abord quelques recettes, puis planifiez-les !
        = link_to new_recipe_path, class: "btn btn-primary btn-sm sm:btn-md w-full sm:w-auto"
          span âœ¨
          span CrÃ©er ma premiÃ¨re recette
